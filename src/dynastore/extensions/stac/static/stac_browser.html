<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DynaStore | STAC Browser</title>
    
    <!-- Favicon and Fonts from main app -->
    <link rel="icon" type="image/png" href="/web/static/dynastore.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- STAC Browser CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/stac-browser/dist/style.css">
    <script src="https://cdn.jsdelivr.net/npm/stac-browser/dist/stac-browser.js"></script>

    <style>
        /* Basic styling to match the dark theme */
        body {
            font-family: 'Inter', sans-serif; /* Assuming Inter is available or falls back */
            background-color: #020617; /* dyna-darker */
            color: #e2e8f0; /* slate-200 */
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header to provide context and a way back */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            flex-shrink: 0;
        }
        .header-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: bold;
            font-size: 1.25rem;
            color: white;
        }
        .header-title img {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
        }
        .back-link {
            color: #94a3b8; /* slate-400 */
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }
        .back-link:hover {
            color: white;
        }

        /* STAC Browser container */
        #stac-browser-container {
            flex-grow: 1;
            overflow: hidden;
            padding: 1rem;
        }

        /* Overriding STAC Browser styles for dark theme */
        :root {
            --stac-browser-bg-color: #0f172a; /* dyna-dark */
            --stac-browser-bg-color-light: #1e293b; /* a bit lighter */
            --stac-browser-bg-color-dark: #020617; /* dyna-darker */
            --stac-browser-primary-color: #3b82f6; /* dyna-primary */
            --stac-browser-secondary-color: #64748b; /* dyna-secondary */
            --stac-browser-text-color: #e2e8f0; /* slate-200 */
            --stac-browser-link-color: #0ea5e9; /* dyna-accent */
            --stac-browser-border-color: rgba(255, 255, 255, 0.1);
            --stac-browser-font-family: 'Inter', sans-serif;
            --stac-browser-font-family-mono: 'Fira Code', monospace;
        }
        
        /* More specific overrides for better integration */
        .stac-browser .thumbnail-overlay {
            background-color: rgba(15, 23, 42, 0.7);
        }
        .stac-browser .breadcrumb a {
            color: var(--stac-browser-link-color);
        }
        .stac-browser .card, .stac-browser .card-body {
             background-color: var(--stac-browser-bg-color-light);
             border: 1px solid var(--stac-browser-border-color);
        }
        .stac-browser .nav-link.active {
            background-color: var(--stac-browser-primary-color) !important;
            border-color: var(--stac-browser-primary-color) !important;
        }
        .stac-browser .nav-link {
            border: 1px solid var(--stac-browser-border-color);
            color: var(--stac-browser-text-color);
        }
        .stac-browser .nav-link:hover {
            background-color: var(--stac-browser-bg-color);
        }
        .stac-browser .search-input {
            background-color: var(--stac-browser-bg-color-dark);
            border: 1px solid var(--stac-browser-border-color);
            color: var(--stac-browser-text-color);
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-title">
            <img src="/web/static/dynastore.png" alt="DynaStore Logo">
            <span>STAC Browser</span>
        </div>
        <a href="/web/" class="back-link">
            <i class="fa-solid fa-arrow-left"></i> Back to Home
        </a>
    </header>

    <div id="stac-browser-container"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const container = document.getElementById('stac-browser-container');
            if (!container) {
                console.error("STAC Browser container not found.");
                return;
            }

            try {
                // The root of your STAC API
                // 1. Check for 'url' parameter
                const urlParams = new URLSearchParams(window.location.search);
                let stacRootUrl = urlParams.get('url');

                // 2. Fallback to computed local STAC root
                // Assumes STAC root is at /stac/ relative to the app root
                if (!stacRootUrl) {
                    const pathParts = window.location.pathname.split('/');
                    // Find where 'web' starts to know the prefix. Warning: this simple logic might fail with custom prefixes.
                    // Better approach: Go up from /web/pages/stac_browser -> /stac/
                    // Actually, let's use origin + /stac/ if we are at root, or handle prefixes.
                    // We can also assume the app is hosted at root for now or rely on relative "../../../stac/" if possible.
                    // But StacBrowser needs an absolute URL usually.
                    
                    // Robust way: removing /web/.* from current path and adding /stac/
                    const currentPath = window.location.pathname;
                    const webIndex = currentPath.indexOf('/web/');
                    if (webIndex !== -1) {
                         stacRootUrl = window.location.origin + currentPath.substring(0, webIndex) + '/stac/';
                    } else {
                         stacRootUrl = window.location.origin + '/stac/';
                    }
                }

                console.log("Loading STAC Browser with root:", stacRootUrl);

                const browser = new StacBrowser(container, {
                    catalogUrl: stacRootUrl,
                    allowExternalAccess: true, // Allow navigating to external STAC resources if linked
                    showThumbnails: true,
                    useAbsoluteUrls: false,
                    // The theme is mostly handled by CSS variables now
                });

            } catch (error) {
                console.error("Error initializing STAC Browser:", error);
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Could not load STAC Browser. See console for details.</div>';
            }
        });
    </script>

</body>
</html>
